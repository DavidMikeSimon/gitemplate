#!/usr/bin/env node

var util = require('util');
var cli = require('commander');
var Gitemplate = require(__dirname + '/../dist/gitemplate').Gitemplate;

cli
  .option('-n, --name <new component>', '', String)
  .option('-s, --src <source repo>', '', String)
  .option('-d, --dst <destination dir>', '', String)
  .parse(process.argv);

var gt = new Gitemplate();
gt
  .set('name', cli.name)
  .set('nativeRequire', require)
  .init();

function abort(msg, code) {
  util.error(msg);
  process.exit(typeof code === 'undefined' ? 1 : code);
}

function abortOnErrorResult(res) {
  if (res.code !== 0) { abort(res.output, res.code); }
}

var requiredParams = ['name', 'src', 'dst'];

requiredParams.forEach(function(param) {
  if (!cli[param]) { abort('--' + param + ' required'); }
});

abortOnErrorResult(gt.cloneRepo(cli.src, cli.dst));
gt.rmGitDir(cli.dst)

